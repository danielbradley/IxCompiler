
.. Ix Source Statement

~!include/ixcompiler.IxSourceStatement.h~
#ifndef IXCOMPILER_IXSOURCESTATEMENT_H
#define IXCOMPILER_IXSOURCESTATEMENT_H

#include "ixcompiler.h"

IxSourceStatement* IxSourceStatement_new( const Node* aNode );

IxSourceStatement*         IxSourceStatement_free          (       IxSourceStatement** self );
const IxSourceBlock*       IxSourceStatement_getBlock      ( const IxSourceStatement*  self );
const IxSourceConditional* IxSourceStatement_getConditional( const IxSourceStatement*  self );
const IxSourceDeclaration* IxSourceStatement_getDeclaration( const IxSourceStatement*  self );
const IxSourceExpression*  IxSourceStatement_getExpression ( const IxSourceStatement*  self );
bool                       IxSourceStatement_isComplex     ( const IxSourceStatement*  self );
bool                       IxSourceStatement_isDeclaration ( const IxSourceStatement*  self );
bool                       IxSourceStatement_isExpression  ( const IxSourceStatement*  self );

#endif
~

~!c/ixcompiler.IxSourceStatement.c~
#include "ixcompiler.Array.h"
#include "ixcompiler.EnumTokenType.h"
#include "ixcompiler.IxSourceBlock.h"
#include "ixcompiler.IxSourceConditional.h"
#include "ixcompiler.IxSourceDeclaration.h"
#include "ixcompiler.IxSourceExpression.h"
#include "ixcompiler.IxSourceStatement.h"
#include "ixcompiler.Node.h"
#include "ixcompiler.NodeIterator.h"
#include "ixcompiler.Platform.h"
#include "ixcompiler.String.h"
#include "ixcompiler.StringBuffer.h"
#include "ixcompiler.Token.h"

struct _IxSourceStatement
{
    bool                 invalid;
    bool                 isComplex;
    bool                 isDeclaration;
    bool                 isExpression;
    String*              statementType;
    IxSourceBlock*       block;
    IxSourceConditional* conditional;
    IxSourceDeclaration* declaration;
    IxSourceExpression*  expression;
};

void IxSourceStatement_parse( IxSourceStatement* self, const Node* firstNode );
~

~c/ixcompiler.IxSourceStatement.c~
IxSourceStatement* IxSourceStatement_new( const Node* firstNode )
{
    IxSourceStatement* self = Platform_Alloc( sizeof(IxSourceStatement) );
    if ( self )
    {
        IxSourceStatement_parse( self, firstNode );
    }
    return self;
}
~

~c/ixcompiler.IxSourceStatement.c~
IxSourceStatement* IxSourceStatement_free( IxSourceStatement** self )
{
    if ( *self )
    {
        String_free             ( &(*self)->statementType );
        IxSourceBlock_free      ( &(*self)->block         );
        IxSourceConditional_free( &(*self)->conditional   );
        IxSourceDeclaration_free( &(*self)->declaration   );
        IxSourceExpression_free ( &(*self)->expression    );

        Platform_Free( self );
    }
    return *self;
}
~

~c/ixcompiler.IxSourceStatement.c~
const IxSourceBlock* IxSourceStatement_getBlock( const IxSourceStatement* self )
{
    return self->block;
}
~

~c/ixcompiler.IxSourceStatement.c~
const IxSourceConditional* IxSourceStatement_getConditional( const IxSourceStatement* self )
{
    return self->conditional;
}
~

~c/ixcompiler.IxSourceStatement.c~
const IxSourceDeclaration* IxSourceStatement_getDeclaration( const IxSourceStatement*  self )
{
    return self->declaration;
}
~

~c/ixcompiler.IxSourceStatement.c~
const IxSourceExpression*  IxSourceStatement_getExpression ( const IxSourceStatement*  self )
{
    return self->expression;
}
~

~c/ixcompiler.IxSourceStatement.c~
bool IxSourceStatement_isComplex( const IxSourceStatement* self )
{
    return self->isComplex;
}
~

~c/ixcompiler.IxSourceStatement.c~
bool IxSourceStatement_isDeclaration( const IxSourceStatement* self )
{
    return self->isDeclaration;
}
~

~c/ixcompiler.IxSourceStatement.c~
bool IxSourceStatement_isExpression( const IxSourceStatement* self )
{
    return self->isExpression;
}
~

~c/ixcompiler.IxSourceStatement.c~
void IxSourceStatement_parse( IxSourceStatement* self, const Node* firstNode )
{
    const Token* token = Node_getToken( firstNode );
    const char*  value = Token_getContent( token );

    if ( Token_getTokenType( token ) == KEYWORD )
    {
        if ( String_Equals( value, "var" ) )
        {
            self->isDeclaration = TRUE;
            self->declaration   = IxSourceDeclaration_new( firstNode );
        }
        else
        if ( String_Equals( value, "return" ) )
        {
            self->isExpression = TRUE;
            self->expression   = IxSourceExpression_new( firstNode );
        }
        else
        {
            self->isComplex     = TRUE;
            self->statementType = String_new( Token_getContent( token ) );
            self->conditional   = IxSourceConditional_new( firstNode );

            NodeIterator* it = Node_iterator( firstNode );
            if ( NodeIterator_hasNonWhitespaceOfType( it, STARTEXPRESSION ) )
            {
                NodeIterator_next( it );
            }

            if ( NodeIterator_hasNonWhitespaceOfType( it, STARTBLOCK ) )
            {
                self->block = IxSourceBlock_new( NodeIterator_next( it ) );
            }
        }
    }
    else
    {
        self->isExpression = TRUE;
        self->expression   = IxSourceExpression_new( firstNode );
    }
}
~
