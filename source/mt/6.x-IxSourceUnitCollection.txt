
.. IxSourceUnit Collection

~!include/ixcompiler.IxSourceUnitCollection.h~
#ifndef IXCOMPILER_IXSOURCEUNITCOLLECTION_H
#define IXCOMPILER_IXSOURCEUNITCOLLECTION_H

#include "ixcompiler.h"

IxSourceUnitCollection* IxSourceUnitCollection_new();
IxSourceUnitCollection* IxSourceUnitCollection_free( IxSourceUnitCollection** self                              );
void                    IxSourceUnitCollection_add ( IxSourceUnitCollection*  self, IxSourceUnit** IxSourceUnit );

int                     IxSourceUnitCollection_getLength        ( const IxSourceUnitCollection* self );
const IxSourceUnit*     IxSourceUnitCollection_get              ( const IxSourceUnitCollection* self, int index );
ArrayOfString*          IxSourceUnitCollection_retrieveTypes    ( const IxSourceUnitCollection* self );
ArrayOfString*          IxSourceUnitCollection_retrieveFunctions( const IxSourceUnitCollection* self );

const ArrayOfString*    IxSourceUnitCollection_getCopyrightLines( const IxSourceUnitCollection* self );
const ArrayOfString*    IxSourceUnitCollection_getLicenseLines  ( const IxSourceUnitCollection* self );
const Dictionary*       IxSourceUnitCollection_getResolvedTypes ( const IxSourceUnitCollection* self );
const Dictionary*       IxSourceUnitCollection_getSignatures    ( const IxSourceUnitCollection* self );

#endif
~

~!c/ixcompiler.IxSourceUnitCollection.c~
#include "ixcompiler.Array.h"
#include "ixcompiler.ArrayOfString.h"
#include "ixcompiler.Dictionary.h"
#include "ixcompiler.IxSourceMethod.h"
#include "ixcompiler.IxSourceSignature.h"
#include "ixcompiler.IxSourceUnit.h"
#include "ixcompiler.IxSourceUnitCollection.h"
#include "ixcompiler.Platform.h"
#include "ixcompiler.String.h"

struct _IxSourceUnitCollection
{
    Array*         collection;
    ArrayOfString* copyrightLines;
    ArrayOfString* licenseLines;
    Dictionary*    resolvedTypes;
    Dictionary*    signatures;
};
~

~c/ixcompiler.IxSourceUnitCollection.c~
IxSourceUnitCollection* IxSourceUnitCollection_new()
{
    IxSourceUnitCollection* self = Platform_Alloc( sizeof( IxSourceUnitCollection ) );
    if ( self )
    {
        self->collection     = Array_new( (Destructor) IxSourceUnit_free );
        self->copyrightLines = ArrayOfString_new();
        self->licenseLines   = ArrayOfString_new();
        self->resolvedTypes  = Dictionary_new( FALSE, (Destructor) String_free );
        self->signatures     = Dictionary_new( FALSE, null );
    }
    return self;
}
~

~c/ixcompiler.IxSourceUnitCollection.c~
IxSourceUnitCollection* IxSourceUnitCollection_free( IxSourceUnitCollection** self )
{
    if ( *self )
    {
        if ( (*self)->collection )
        {
            IxSourceUnit* sourceFile;

            while ( (sourceFile = Array_pop( (*self)->collection )) )
            {
                IxSourceUnit_free( &sourceFile );
            }
            Array_free        ( &(*self)->collection     );
            ArrayOfString_free( &(*self)->copyrightLines );
            ArrayOfString_free( &(*self)->licenseLines   );
            Dictionary_free   ( &(*self)->resolvedTypes  );
            Dictionary_free   ( &(*self)->signatures     );

            Platform_Free( self );
        }
    }
    return *self;
}
~

~c/ixcompiler.IxSourceUnitCollection.c~
void IxSourceUnitCollection_add( IxSourceUnitCollection* self, IxSourceUnit** sourceUnit )
{
    ArrayOfString_union( self->copyrightLines, IxSourceUnit_getCopyrightLines( *sourceUnit ) );
    ArrayOfString_union( self->licenseLines,   IxSourceUnit_getLicenseLines  ( *sourceUnit ) );

    Dictionary_put
    (
        self->resolvedTypes,
        (String**) Give( String_copy( IxSourceUnit_getName    ( *sourceUnit ) ) ),
        (void**)   Give( String_copy( IxSourceUnit_getFullName( *sourceUnit ) ) )
    );

    const char*  prefix  = IxSourceUnit_getPrefix ( *sourceUnit );
    const Array* methods = IxSourceUnit_getMethods( *sourceUnit );
    int n = Array_getLength( methods );
    for ( int i=0; i < n; i++ )
    {
        const IxSourceMethod*    method    = (const IxSourceMethod*) Array_getObject( methods, i );
        const IxSourceSignature* signature = IxSourceMethod_getSignature( method );

        String* signature_name = IxSourceSignature_generateName( signature, prefix );

        Dictionary_put_reference( self->signatures, &signature_name, signature );
    }

    Array_push( self->collection, (void**) sourceUnit );
}
~

~c/ixcompiler.IxSourceUnitCollection.c~
int IxSourceUnitCollection_getLength( const IxSourceUnitCollection* self )
{
    return Array_getLength( self->collection );
}
~

~c/ixcompiler.IxSourceUnitCollection.c~
const IxSourceUnit*     IxSourceUnitCollection_get      ( const IxSourceUnitCollection* self, int index )
{
    return Array_getObject( self->collection, index );
}
~

~c/ixcompiler.IxSourceUnitCollection.c~
ArrayOfString* IxSourceUnitCollection_retrieveTypes( const IxSourceUnitCollection* self )
{
    ArrayOfString* types = ArrayOfString_new();
    {
        int n = IxSourceUnitCollection_getLength( self );

        String* tmp;

        for ( int i=0; i < n; i++ )
        {
            const IxSourceUnit* unit     = IxSourceUnitCollection_get( self, i );
            const String*       fullName = IxSourceUnit_getFullName( unit );

            ArrayOfString_push( types, (String**) Give( String_copy( fullName ) ) );
        }
    }
    return types;
}
~

~c/ixcompiler.IxSourceUnitCollection.c~
ArrayOfString* IxSourceUnitCollection_retrieveFunctions( const IxSourceUnitCollection* self )
{
    ArrayOfString* functions = ArrayOfString_new();
    return functions;
}
~

~c/ixcompiler.IxSourceUnitCollection.c~
const ArrayOfString* IxSourceUnitCollection_getCopyrightLines( const IxSourceUnitCollection* self )
{
    return self->copyrightLines;
}
~

~c/ixcompiler.IxSourceUnitCollection.c~
const ArrayOfString* IxSourceUnitCollection_getLicenseLines( const IxSourceUnitCollection* self )
{
    return self->licenseLines;
}
~

~c/ixcompiler.IxSourceUnitCollection.c~
const Dictionary* IxSourceUnitCollection_getResolvedTypes( const IxSourceUnitCollection* self )
{
    return self->resolvedTypes;
}
~

~c/ixcompiler.IxSourceUnitCollection.c~
const Dictionary* IxSourceUnitCollection_getSignatures( const IxSourceUnitCollection* self )
{
    return self->signatures;
}
~
