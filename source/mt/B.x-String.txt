
.. String

~!include/ixcompiler.String.h~
#ifndef IXCOMPILER_STRING_H
#define IXCOMPILER_STRING_H

String*        String_new    ( const char* content );

String*        String_free          (       String** self );
const char*    String_content       ( const String*  self );
int            String_getLength     ( const String*  self );
String*        String_copy          ( const String*  self );
String*        String_cat           ( const String*  self, const String* other );
bool           String_equals        ( const String*  self, const String* other );
bool           String_equals_chars  ( const String*  self, const char*   chars );
bool           String_contains      ( const String*  self, const String* other );
bool           String_contains_chars( const String*  self, const char*   chars );
ArrayOfString* String_split         ( const String*  self, char separator      );
String*        String_toUpperCase   ( const String*  self );
String*        String_replace       ( const String*  self, char ch, char with );

char*          String_Cat   ( const char* string1, const char* string2 );
bool           String_Equals( const char* string1, const char* string2 );
int            String_Length( const char* s );
char*          String_Copy  ( const char* s );

#endif
~

~!c/ixcompiler.String.c~
#include <string.h>
#include "ixcompiler.h"
#include "ixcompiler.ArrayOfString.h"
#include "ixcompiler.Platform.h"
#include "ixcompiler.String.h"
#include "ixcompiler.StringBuffer.h"

struct _String
{
    char* content;
    int   length;
};
~

~c/ixcompiler.String.c~
String* String_new( const char* content )
{
    String* self = Platform_Alloc( sizeof(String) );
    if ( self )
    {
        self->content = String_Copy( content );
        self->length  = String_Length( content );
    }
    return self;
}
~

~c/ixcompiler.String.c~
String* String_free( String** self )
{
    if ( *self )
    {
        Platform_Free( &(*self)->content );
        Platform_Free(    self           );
    }
    return *self;
}
~

~c/ixcompiler.String.c~
const char* String_content( const String* self )
{
    return self->content;
}
~

~c/ixcompiler.String.c~
int String_getLength( const String* self )
{
    return self->length;
}
~

~c/ixcompiler.String.c~
String* String_copy( const String* self )
{
    return String_new( self->content );
}
~

~c/ixcompiler.String.c~
String* String_cat( const String* self, const String* other )
{
    char* tmp = String_Cat( self->content, other->content );
    String* ret = String_new( tmp );
    Platform_Free( &tmp );

    return ret;
}
~

~c/ixcompiler.String.c~
bool String_equals( const String* self, const String* other )
{
    return String_Equals( self->content, other->content );
}
~

~c/ixcompiler.String.c~
bool String_equals_chars( const String* self, const char* chars )
{
    if ( self && chars )
    {
        const char* content = String_content( self );
        return (0 == strcmp( content, chars ));
    }
    else
    {
        return FALSE;
    }
}
~

~c/ixcompiler.String.c~
bool String_contains( const String* self, const String* other )
{
    return String_contains_chars( self, String_content( other ) );
}
~

~c/ixcompiler.String.c~
bool String_contains_chars( const String* self, const char* chars )
{
    return (NULL != strstr( String_content( self ), chars ));
}
~

~c/ixcompiler.String.c~
ArrayOfString* String_split( const String* self, char separator )
{
    ArrayOfString* strings = ArrayOfString_new();
    {
        StringBuffer* sb      = StringBuffer_new();
        const char*   content = String_content( self );
        int           n       = String_getLength( self );

        for ( int i=0; i < n; i++ )
        {
            if ( content[i] == separator )
            {
                if ( !StringBuffer_isEmpty( sb ) )
                {
                    String* sbc = String_new( StringBuffer_content( sb ) );
                    ArrayOfString_push( strings, &sbc );
                    StringBuffer_free( &sb );
                    sb = StringBuffer_new();
                }
            }
            else
            {
                StringBuffer_append_char( sb, content[i] );
            }
        }

        if ( !StringBuffer_isEmpty( sb ) )
        {
            String* sbc = String_new( StringBuffer_content( sb ) );
            ArrayOfString_push( strings, &sbc );
        }
        StringBuffer_free( &sb );
    }
    return strings;
}
~

~c/ixcompiler.String.c~
String* String_toUpperCase( const String* self )
{
    String* ret = null;
    {
        char* buffer = String_Copy( self->content );
        int   n      = self->length;

        for ( int i=0; i < n; i++ )
        {
            int ch = buffer[i];

            //    'a'                 'z'
            if ( (97 <= ch) && (ch <= 122) )
            {
                buffer[i] = ch - 32;
            }
        }
        ret = String_new( buffer );
        Platform_Free( &buffer );
    }
    return ret;
}
~

~c/ixcompiler.String.c~
String* String_replace( const String* self, char ch, char with )
{
    String* ret = null;
    {
        char* buffer = String_Copy( self->content );
        int   n      = self->length;

        for ( int i=0; i < n; i++ )
        {
            if ( ch == buffer[i] ) buffer[i] = with;
        }
        ret = String_new( buffer );
        Platform_Free( &buffer );
    }
    return ret;
}
~

~c/ixcompiler.String.c~
char* String_Cat( const char* s1, const char* s2 )
{
    int len1 = String_Length( s1 );
    int len2 = String_Length( s2 );
    int len  = len1 + len2 + 1;

    char* concatenated = Platform_Array( len, sizeof( char ) );

    int t=0;

    for ( int i=0; i < len1; i++ )
    {
        concatenated[t++] = s1[i];
    }

    for ( int i=0; i < len2; i++ )
    {
        concatenated[t++] = s2[i];
    }

    concatenated[t] = '\0';

    return concatenated;
}
~

~c/ixcompiler.String.c~
char* String_Copy( const char* s )
{
    int   len  = String_Length( s ) + 2;
    char* copy = Platform_Array( len, sizeof( char ) );

    return strcpy( copy, s );
}
~

~c/ixcompiler.String.c~
bool String_Equals( const char* string1, const char* string2 )
{
    if ( (NULL == string1) || (NULL == string2) )
    {
        return FALSE;
    }
    else
    {
        return (0 == strcmp( string1, string2 ));
    }
}
~

~c/ixcompiler.String.c~
int String_Length( const char* s )
{
    return strlen( s );
}
~
